<% var accountNumber=accountNumber; %>
<script>
  var getAccountNumber = "<%= accountNumber %>";
  window.onload = function () {
    // document.getElementById("download-btn").onclick = function () {

      let theNode = document.getElementById("month-by-month-chart");
      // let theNode = document.getElementById("another-wrapper");

      // domtoimage.toBlob(theNode, { height: 590, width: 800 })
      // only properly renders in firefox
      domtoimage.toBlob(theNode)

        .then(function (blob) {
          //image as 'blob' https://developer.mozilla.org/en-US/docs/Web/API/Blob)
          blob.arrayBuffer().then(function (buffer) {
            //'buffer' is image in ArrayBuffer containing blob's data in binary form - probably what you wanna use.
            // console.log(buffer);

            const params = {
              Bucket: "bengal-12-poc",
              Key: `${getAccountNumber}_chart.png`, // The name of the object
              Body: buffer, // The content of the object
              ACL: "bucket-owner-full-control",
              // ACL: "public-read",
              ContentType: "image/png"

            };

            let s3 = new AWS.S3({
              apiVersion: "2006-03-01",
              // accessKeyId: process.env.AWS_ACCESS_KEY_ID,
              // secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,
              
            });

            s3.upload(params, function (err, data) {
              if (err) {
                console.log("Error", err);
              } if (data) {
                console.log("Upload Success", data.Location);
              }
            })
          });

          // window.saveAs(blob, "test.png");
        });
    // }
  }
</script>